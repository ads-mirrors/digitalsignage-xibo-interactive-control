{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/xibo-interactive-control.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","window","xiboIC","_lib","protocol","hostName","port","headers","timelimit","callbackQueue","isVisible","isPreview","targetId","xiboICTargetId","undefined","getOriginURL","this","makeRequest","path","_ref","arguments","length","type","data","done","error","parent","previewActionTrigger","urlToUse","typeToUse","reqHeaders","xhr","XMLHttpRequest","timeout","open","setRequestHeader","forEach","header","newData","_typeof","JSON","stringify","onload","status","send","mainLib","checkVisible","$","urlParam","results","RegExp","exec","location","href","decodeURI","checkIsPreview","lD","config","_ref2","info","_ref3","trigger","code","_ref4","id","expireNow","_ref5","extendWidgetDuration","duration","_ref6","setWidgetDuration","_ref7","addToQueue","callback","console","_len","args","Array","_key","push","runQueue","element","apply","setVisible"],"mappings":"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","file":"xibo-interactive-control.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/xibo-interactive-control.js\");\n","/**\n * Copyright (C) 2020 Xibo Signage Ltd\n *\n * Xibo - Digital Signage - http://www.xibo.org.uk\n *\n * This file is part of Xibo.\n *\n * Xibo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * any later version.\n *\n * Xibo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Xibo.  If not, see <http://www.gnu.org/licenses/>.\n */\nwindow.xiboIC = (function() {\n    'use strict';\n\n    // Private vars\n    const _lib = {\n        protocol: '', // default protocol \n        hostName: '', // default URL \n        port: '', // default PORT \n        headers: [], // Default headers \n        timelimit: 5000, // timelimit in milliseconds\n        callbackQueue : [],\n        isVisible: true, // Widget visibility on the player\n        isPreview: false, // If the library is being used by a preview\n        targetId: (typeof xiboICTargetId != 'undefined') ? xiboICTargetId : undefined, // target id\n\n        /**\n         * Get URL string\n         */\n        getOriginURL: function() {\n            if (this.protocol != '' && this.hostName != '') {\n                return this.protocol + '://' + this.hostName + ((this.port != '') ? ':' + this.port : '');\n            }\n            return '';\n        },\n\n        /**\n         * Make a request to the configured server/player\n         * @param  {string} path - Request path\n         * @param  {Object} [options] - Optional params\n         * @param  {string} [options.type]\n         * @param  {Object[]} [options.headers] - Request headers in the format {key: key, value: value}\n         * @param  {Object} [options.data]\n         * @param  {callback} [options.done]\n         * @param  {callback} [options.error]\n         */\n        makeRequest: function(path, {type, headers, data, done, error} = {}) {\n            const self = this;\n\n            // Preview\n            if(self.isPreview) {\n                // Call the preview action if it exists\n                if(typeof parent.previewActionTrigger == 'function') {\n                    parent.previewActionTrigger(path, data, done);\n                }\n\n                // Stop the method to avoid a request\n                return;\n            }\n            \n            const urlToUse = self.getOriginURL() + path;\n            const typeToUse = (type) ? type : 'GET';\n            const reqHeaders = (headers) ? headers : self.headers;\n\n            // Init AJAX\n            let xhr = new XMLHttpRequest();\n            xhr.timeout = self.timelimit;\n\n            xhr.open(typeToUse, urlToUse, true);\n\n            // Set headers\n            if(type == 'POST') {\n                xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');\n            }\n\n            reqHeaders.forEach(header => {\n                xhr.setRequestHeader(header.key, header.value);\n            });\n\n            // Append data\n            let newData = null;\n            if (typeof(data) == \"object\") {\n                newData = JSON.stringify(data);\n            }\n\n            // On load complete\n            xhr.onload = function() {\n                if(xhr.status == '200') {\n                    if (typeof(done) == \"function\") {\n                        done(this);\n                    }\n                } else {\n                    if (typeof(error) == \"function\") {\n                        error(this);\n                    }\n                }\n            };\n\n            // Send!\n            xhr.send(newData);\n        },\n    };\n\n    // Public library\n    const mainLib = {\n        /**\n         * Check if the current widget is visible\n         */\n        checkVisible: function() { // Check if the widget is hidden or visible\n            $.urlParam = function(name){\n                var results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(window.location.href);\n                if (results == null){\n                   return null;\n                }\n                else {\n                   return decodeURI(results[1]) || 0;\n                }\n            };\n            \n            _lib.isVisible = ($.urlParam(\"visible\")) ? ($.urlParam(\"visible\") == 1) : true;\n            return _lib.isVisible;\n        },\n\n        /**\n         * Check if we're running in a preview\n         */\n        checkIsPreview: function() {\n            // For the widget preview in viewer\n            if(typeof window.parent.lD != 'undefined' || typeof window.parent.parent.lD != 'undefined') {\n                _lib.isPreview = true;\n                return true;\n            }\n\n            return false;\n        },\n\n        /**\n         * Configure the library options\n         * @param  {Object} [options]\n         * @param  {string} [options.hostName]\n         * @param  {string} [options.port]\n         * @param  {Object[]} [options.headers] - Request headers in the format {key: key, value: value}\n         * @param  {string} [options.headers.key]\n         * @param  {string} [options.headers.value]\n         * @param  {string} [options.protocol]\n         */\n        config: function({ hostName, port, headers, protocol } = {}) {\n            // Initialise custom request params\n            _lib.hostName = hostName ? hostName : _lib.hostName;\n            _lib.port = port ? port : _lib.port;\n            _lib.headers = headers ? headers : _lib.headers;\n            _lib.protocol = protocol ? protocol : _lib.protocol;\n        },\n\n        /**\n         * Get player info\n         * @param  {Object[]} [options] - Request options\n         * @param  {callback} [options.done]\n         * @param  {callback} [options.error]\n         */\n        info: function({ done, error } = {}) {\n            _lib.makeRequest(\n                '/info',\n                {\n                    done: done,\n                    error: error\n                }\n            );\n        },\n        \n        /**\n         * Trigger a predefined action\n         * @param  {string} code - The trigger code\n         * @param  {string} [options.targetId] - target id\n         * @param  {Object[]} [options] - Request options\n         * @param  {callback} [options.done]\n         * @param  {callback} [options.error]\n         */\n        trigger(code, { targetId, done, error } = {}) {\n            // Get target id from the request option or from the global lib var\n            var id = (typeof targetId != 'undefined') ? targetId : _lib.targetId;\n\n            _lib.makeRequest(\n                '/trigger',\n                {\n                    type: 'POST',\n                    data: {\n                        id: id,\n                        trigger: code\n                    },\n                    done: done,\n                    error: error\n                }\n            );\n        },\n\n        /**\n         * Expire widget\n         * @param  {Object[]} [options] - Request options\n         * @param  {string} [options.targetId] - target id\n         * @param  {callback} [options.done]\n         * @param  {callback} [options.error]\n         */\n        expireNow({ targetId, done, error } = {}) {\n            // Get target id from the request option or from the global lib var\n            var id = (typeof targetId != 'undefined') ? targetId : _lib.targetId;\n\n            _lib.makeRequest(\n                '/duration/expire',\n                {\n                    type: 'POST',\n                    data: {\n                        id: id\n                    },\n                    done: done,\n                    error: error\n                }\n            );\n        },\n        \n        /**\n         * Extend widget duration\n         * @param  {string} duration - Duration value to extend\n         * @param  {Object[]} [options] - Request options\n         * @param  {string} [options.targetId] - target id\n         * @param  {callback} [options.done]\n         * @param  {callback} [options.error]\n         */\n        extendWidgetDuration(duration, { targetId, done, error } = {}) {\n            // Get target id from the request option or from the global lib var\n            var id = (typeof targetId != 'undefined') ? targetId : _lib.targetId;\n\n            _lib.makeRequest(\n                '/duration/extend',\n                {\n                    type: 'POST',\n                    data: {\n                        id: id,\n                        duration: duration\n                    },\n                    done: done,\n                    error: error\n                }\n            );\n        },\n        \n        /**\n         * Set widget duration\n         * @param  {string} duration - New widget duration\n         * @param  {Object[]} [options] - Request options\n         * @param  {string} [options.targetId] - target id\n         * @param  {callback} [options.done]\n         * @param  {callback} [options.error]\n         */\n        setWidgetDuration(duration, { targetId, done, error } = {}) {\n            // Get target id from the request option or from the global lib var\n            var id = (typeof targetId != 'undefined') ? targetId : _lib.targetId;\n\n            _lib.makeRequest(\n                '/duration/set',\n                {\n                    type: 'POST',\n                    data: {\n                        id: id,\n                        duration: duration\n                    },\n                    done: done,\n                    error: error\n                }\n            );\n        },\n\n        /**\n         * Add callback function to the queue\n         * @param  {callback} callback - Function to store\n         * @param  {Object[]} [args] - Function arguments\n         */\n        addToQueue(callback, ...args) {\n            if(typeof callback != 'function') {\n                console.error('Invalid callback function');\n            }\n\n            _lib.callbackQueue.push({\n                callback: callback,\n                arguments: args\n            });\n        },\n\n        /**\n         * Run promised functions in queue\n         */\n        runQueue() {\n            _lib.callbackQueue.forEach((element) => {\n                element.callback.apply(_lib, element.arguments);\n            });\n\n            // Empty queue\n            _lib.callbackQueue = [];\n        },\n\n        /**\n         * Set visible and run queue\n         */\n        setVisible() {\n            _lib.isVisible = true;\n            this.runQueue();\n        }\n    };\n\n    // Check visibility on load\n    mainLib.checkVisible();\n\n    // Check if it's a preview\n    mainLib.checkIsPreview();\n    \n    return mainLib;\n})();\n"],"sourceRoot":""}